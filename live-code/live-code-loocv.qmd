---
title: "Live code:"
date: "March 9, 2023"
description: "LOOCV"
editor: visual
categories: "Live code"
format:
  html: 
    code-fold: false
    code-line-numbers: true
draft: true
editor_options: 
  chunk_output_type: console
---

### Data

```{r message = F}
library(tidyverse)
library(vegan)
data(mite)
data(mite.env)
mite_dat <- mite.env %>%
  add_column(abundance = mite$LRUG)
```

### LOOCV

```{r}
#| code-line-numbers: true
n <- nrow(mite_dat)
rmses <- rep(NA, n)
true_y <- mite_dat$abundance
for(i in 1:n){
  mod <- lm(abundance ~ WatrCont + SubsDens, data = mite_dat[-i,])
  pred <- predict(mod, newdata = mite_dat[i,])
  rmses[i] <- (true_y[i] - pred)^2
}
loocv_err <- mean(rmses)
loocv_err
```

Comprehension question check: why did I not take the square root in line 7 above?

```{r}
#| echo: false
#| eval: false
n <- nrow(mite_dat)
k <- 5
set.seed(7)
# the following creates a list
fold_ids <- split(sample(1:n), ceiling(seq_along(1:n)/(n/k)))
true_y <- mite_dat$abundance
errs <- rep(NA, k)
for(i in 1:k){
  # to access list elements, use double brackets
  test_fold_ids <- fold_ids[[i]]
  mod <- lm(abundance ~ WatrCont + SubsDens, data = mite_dat[-test_fold_ids,])
  pred <- predict(mod, newdata = mite_dat[test_fold_ids,])
  errs[i] <- get_rmse(true_y[test_fold_ids], pred) 
}
kfold_err <- mean(errs)
```
